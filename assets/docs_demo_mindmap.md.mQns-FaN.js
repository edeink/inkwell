var s=Object.defineProperty;var t=(a,e)=>s(a,"name",{value:e,configurable:!0});import{_ as p,C as r,c as m,o as u,j as o,G as l,ai as i,a as d}from"./chunks/framework.BnOgjZe9.js";const f=JSON.parse('{"title":"思维导图","description":"","frontmatter":{"title":"思维导图","sidebar_label":"思维导图"},"headers":[],"relativePath":"docs/demo/mindmap.md","filePath":"docs/demo/mindmap.md"}'),g={name:"docs/demo/mindmap.md"};function h(a,e,b,k,I,C){const n=r("InkCodeBlock"),c=r("InkMermaidBlock");return u(),m("div",null,[e[3]||(e[3]=o("p",null,"import MindmapDemo from '@mindmap';",-1)),e[4]||(e[4]=o("h1",{id:"思维导图",tabindex:"-1"},[d("思维导图 "),o("a",{class:"header-anchor",href:"#思维导图","aria-label":'Permalink to "思维导图"'},"​")],-1)),e[5]||(e[5]=o("p",null,"这是一个基于 Inkwell 框架实现的思维导图示例，展示了如何用 Canvas 渲染与 Widget 系统构建高性能、强交互的图形应用。",-1)),e[6]||(e[6]=o("h2",{id:"在线演示",tabindex:"-1"},[d("在线演示 "),o("a",{class:"header-anchor",href:"#在线演示","aria-label":'Permalink to "在线演示"'},"​")],-1)),l(n,{"code-base64":"LyoqIEBqc3hJbXBvcnRTb3VyY2UgQC91dGlscy9jb21waWxlciAqLwo8TWluZG1hcERlbW8gd2lkdGg9ezY4Nn0gaGVpZ2h0PXs0MDB9IC8+Cg==",lang:"tsx",meta:"mode:edit height:400"}),e[7]||(e[7]=o("h3",{id:"组件参数-props",tabindex:"-1"},[d("组件参数 (Props) "),o("a",{class:"header-anchor",href:"#组件参数-props","aria-label":'Permalink to "组件参数 (Props)"'},"​")],-1)),e[8]||(e[8]=o("p",null,[d("该示例组件支持 "),o("code",null,"width"),d(" / "),o("code",null,"height"),d(" 两个可选参数，用于在文档等受限容器中固定演示区域尺寸；不传则自动适配父容器并在 "),o("code",null,"Resize"),d(" 时重建渲染树。")],-1)),e[9]||(e[9]=o("h2",{id:"组件架构",tabindex:"-1"},[d("组件架构 "),o("a",{class:"header-anchor",href:"#组件架构","aria-label":'Permalink to "组件架构"'},"​")],-1)),l(c,{"code-base64":"Z3JhcGggVEQKICBFWyJNaW5kbWFwRGVtbyJdIC0tPiBGWyJNaW5kTWFwVmlld3BvcnQiXQogIEYgLS0+IEdbIk1pbmRNYXBMYXlvdXQiXQogIEcgLS0+IEhbIk1pbmRNYXBOb2RlIl0KICBHIC0tPiBJWyJDb25uZWN0b3IiXQogIEcgLS0+IEpbIk1pbmRNYXBOb2RlVG9vbGJhciJdCiAgRSAtLT4gS1siTWluZE1hcEVkaXRvck92ZXJsYXkiXQo="}),e[10]||(e[10]=i('<h2 id="功能特性" tabindex="-1">功能特性 <a class="header-anchor" href="#功能特性" aria-label="Permalink to &quot;功能特性&quot;">​</a></h2><p>该示例实现了思维导图的核心功能，包括：</p><ol><li><p><strong>节点管理</strong></p><ul><li><strong>根节点 (Root)</strong>: 导图的中心主题。</li><li><strong>子节点 (Child)</strong>: 支持无限层级的子节点扩展。</li><li><strong>同级节点 (Sibling)</strong>: 支持在当前节点上方或下方添加同级节点。</li><li><strong>布局自动调整</strong>: 采用 <code>MindMapLayout</code> 实现自动化的树状布局算法（<code>treeBalanced</code>），确保节点互不重叠且视觉平衡。</li></ul></li><li><p><strong>交互操作</strong></p><ul><li><strong>缩放与平移 (Zoom &amp; Pan)</strong>: <code>MindMapViewport</code> 提供滚轮缩放、拖拽漫游、双指捏合等交互。</li><li><strong>选中与激活</strong>: 点击节点进行激活/选中，框选支持批量选择。</li><li><strong>编辑</strong>: 双击节点文本进行编辑。</li></ul></li><li><p><strong>连接线 (Connector)</strong></p><ul><li>使用贝塞尔曲线或折线自动连接父子节点。</li><li>样式可配置（粗细、颜色、虚线等）。</li></ul></li></ol><h2 id="关键模块" tabindex="-1">关键模块 <a class="header-anchor" href="#关键模块" aria-label="Permalink to &quot;关键模块&quot;">​</a></h2><ol><li><p><strong>Widget 层（渲染与命中）</strong></p><ul><li><code>src/demo/mindmap/app.tsx</code>：<code>MindmapDemo</code>（<code>StatefulWidget</code>），维护图数据、选中与编辑态，并渲染 <code>MindMapViewport</code> / <code>MindMapLayout</code> / <code>MindMapNode</code> / <code>Connector</code> 等。</li><li><code>src/demo/mindmap/widgets/*</code>：节点、连接线、布局容器、视口，以及编辑器覆盖层等组件。</li></ul></li><li><p><strong>Controller 层（交互/视图/布局编排）</strong></p><ul><li><code>src/demo/mindmap/controller/index.ts</code>：<code>MindmapController</code>，将交互与渲染解耦为模块化能力。</li><li><code>src/demo/mindmap/controller/modules/*</code>：例如视图同步（ViewModule）、交互处理等模块。</li></ul></li><li><p><strong>算法与基础能力</strong></p><ul><li><code>src/demo/mindmap/helpers/layout-engine/*</code>：树形/平衡树等布局算法。</li><li><code>src/demo/mindmap/helpers/shortcut/*</code>：快捷键与历史记录（撤销/重做）。</li><li><code>src/demo/mindmap/helpers/connection-drawer.ts</code>：连接线路径与样式计算。</li><li><code>src/demo/mindmap/helpers/state-helper.ts</code>：图状态初始化与更新辅助。</li></ul></li><li><p><strong>React 组件层（UI 外围能力）</strong></p><ul><li><code>src/demo/mindmap/components/*</code>：缩略图、工具栏、缩放条、错误边界等（主要是 DOM/UI 侧，负责调用 Widget 层能力）。</li></ul></li><li><p><strong>React 入口（仅负责挂载画布）</strong></p><ul><li><code>src/demo/mindmap/index.tsx</code>：挂载 <code>InkwellCanvas</code>，创建 <code>Runtime</code> 并调用 <code>runApp</code>。</li></ul></li></ol><h2 id="inkwell-最佳实践" tabindex="-1">Inkwell 最佳实践 <a class="header-anchor" href="#inkwell-最佳实践" aria-label="Permalink to &quot;Inkwell 最佳实践&quot;">​</a></h2><h3 id="_1-状态收敛与受控同步" tabindex="-1">1. 状态收敛与受控同步 <a class="header-anchor" href="#_1-状态收敛与受控同步" aria-label="Permalink to &quot;1. 状态收敛与受控同步&quot;">​</a></h3><p>导图的核心状态集中在 <code>MindmapDemo（Widget）</code>：图数据（节点/边）、选中与编辑态，以及 Viewport 的 <code>scale/tx/ty</code>。当 Viewport 发生变换时，通过 <code>onViewChange</code> 回调同步到 <code>MindmapDemo</code> 的状态，确保编辑器覆盖层与命中逻辑在任意缩放下保持一致。</p><h3 id="_2-自定义布局与零分配思路" tabindex="-1">2. 自定义布局与零分配思路 <a class="header-anchor" href="#_2-自定义布局与零分配思路" aria-label="Permalink to &quot;2. 自定义布局与零分配思路&quot;">​</a></h3><p><code>MindMapLayout</code> 负责在 <code>performLayout</code> 中计算子节点偏移与整体尺寸，并在布局完成后通过 <code>onLayout</code> 回调驱动“首次居中”等行为。对于高频路径（布局/绘制/命中），优先复用缓存并减少临时对象生成。</p><h3 id="_3-多坐标系下的命中与交互" tabindex="-1">3. 多坐标系下的命中与交互 <a class="header-anchor" href="#_3-多坐标系下的命中与交互" aria-label="Permalink to &quot;3. 多坐标系下的命中与交互&quot;">​</a></h3><p>导图存在屏幕坐标、Viewport 局部坐标与世界坐标的转换。示例中将坐标变换收敛在 Viewport 的辅助方法与少量工具函数中，确保框选、节点命中与缩略图拖拽在任意缩放比例下都能正确工作。</p><h3 id="_4-类型安全的组件查找-type-safe-component-lookup" tabindex="-1">4. 类型安全的组件查找 (Type-Safe Component Lookup) <a class="header-anchor" href="#_4-类型安全的组件查找-type-safe-component-lookup" aria-label="Permalink to &quot;4. 类型安全的组件查找 (Type-Safe Component Lookup)&quot;">​</a></h3><p>在大型应用中，通过字符串查找组件（<code>findWidget</code>）容易出错且难以维护。本项目强制使用枚举（Enum）来管理组件类型。</p>',14)),o("ul",null,[e[2]||(e[2]=i("<li><strong>定义</strong>: 在 <code>type.ts</code> 中定义 <code>CustomComponentType</code> 枚举。</li><li><strong>使用</strong>: 在 <code>findWidget</code> 和 <code>key</code> 属性中统一使用枚举值，严禁硬编码字符串（如 <code>&#39;#MindMapViewport&#39;</code>）。</li>",2)),o("li",null,[e[0]||(e[0]=o("strong",null,"示例",-1)),e[1]||(e[1]=d(":",-1)),l(n,{"code-base64":"Ly8g4p2MIOmUmeivr++8muehrOe8lueggeWtl+espuS4sgpmaW5kV2lkZ2V0KHJvb3QsICcjTWluZE1hcFZpZXdwb3J0Jyk7CgovLyDinIUg5q2j56Gu77ya5L2/55So5p6a5Li+CmltcG9ydCB7IEN1c3RvbUNvbXBvbmVudFR5cGUgfSBmcm9tICcuL3R5cGUnOwpmaW5kV2lkZ2V0KHJvb3QsIGAjJHtDdXN0b21Db21wb25lbnRUeXBlLk1pbmRNYXBWaWV3cG9ydH1gKTsK",lang:"typescript",meta:""})])]),e[11]||(e[11]=i('<h2 id="代码结构" tabindex="-1">代码结构 <a class="header-anchor" href="#代码结构" aria-label="Permalink to &quot;代码结构&quot;">​</a></h2><ul><li><code>src/demo/mindmap/index.tsx</code>: React 挂载入口（创建 Runtime 并调用 <code>runApp</code>）。</li><li><code>src/demo/mindmap/app.tsx</code>: 画布场景（<code>StatefulWidget</code>）与核心状态管理。</li><li><code>src/demo/mindmap/controller/</code>: Controller 与功能模块（交互、视图、布局编排）。</li><li><code>src/demo/mindmap/components/</code>: DOM/UI 组件（工具栏、缩略图、缩放条等）。</li><li><code>src/demo/mindmap/widgets/</code>: Viewport、Layout、Node、Connector、编辑器覆盖层等渲染组件。</li><li><code>src/demo/mindmap/helpers/</code>: 布局引擎、快捷键、连接线绘制、状态辅助等。</li></ul>',2))])}t(h,"_sfc_render");const y=p(g,[["render",h]]);export{f as __pageData,y as default};
