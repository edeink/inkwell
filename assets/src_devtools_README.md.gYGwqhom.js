var i=Object.defineProperty;var c=(l,e)=>i(l,"name",{value:e,configurable:!0});import{_ as u,C as s,c as h,o as v,ai as d,j as o,G as a,a as t}from"./chunks/framework.BnOgjZe9.js";const _=JSON.parse('{"title":"Inkwell DevTools","description":"","frontmatter":{},"headers":[],"relativePath":"src/devtools/README.md","filePath":"src/devtools/README.md"}'),p={name:"src/devtools/README.md"};function b(l,e,m,g,x,T){const r=s("InkCodeBlock"),n=s("InkMermaidBlock");return v(),h("div",null,[e[3]||(e[3]=d('<h1 id="inkwell-devtools" tabindex="-1">Inkwell DevTools <a class="header-anchor" href="#inkwell-devtools" aria-label="Permalink to &quot;Inkwell DevTools&quot;">​</a></h1><p>Inkwell DevTools 是 <code>@edeink/inkwell</code> 框架的调试工具，提供组件树查看、属性编辑、元素高亮与交互式拾取功能。</p><h2 id="_1-项目整体架构" tabindex="-1">1. 项目整体架构 <a class="header-anchor" href="#_1-项目整体架构" aria-label="Permalink to &quot;1. 项目整体架构&quot;">​</a></h2><p>DevTools 采用 React + Ant Design 构建，作为一个独立的覆盖层（Overlay）挂载到应用中。它通过 <code>Runtime</code> 单例与核心框架进行通信。</p><ul><li><strong>入口层</strong>: <code>src/devtools/index.tsx</code>。负责单例管理 (<code>Devtools</code> class) 和 React 根节点挂载。</li><li><strong>UI 层</strong>: <code>src/devtools/components/</code>。包含面板布局 (<code>LayoutPanel</code>)、树视图、属性编辑器等。</li><li><strong>逻辑层</strong>: <code>src/devtools/hooks/</code>。<code>useMouseInteraction</code> 处理画布交互，<code>useDevtoolsHotkeys</code> 处理快捷键。</li><li><strong>数据转换</strong>: <code>src/devtools/helper/tree.ts</code>。将 Inkwell Widget 树转换为 UI 可用的树结构。</li></ul><h2 id="_2-主要组件及其功能" tabindex="-1">2. 主要组件及其功能 <a class="header-anchor" href="#_2-主要组件及其功能" aria-label="Permalink to &quot;2. 主要组件及其功能&quot;">​</a></h2><table tabindex="0"><thead><tr><th>组件</th><th>路径</th><th>描述</th></tr></thead><tbody><tr><td><strong>DevTools</strong></td><td><code>src/devtools/index.tsx</code></td><td>对外暴露的 React 组件，作为单例的启动入口。</td></tr><tr><td><strong>DevToolsPanel</strong></td><td><code>src/devtools/components/devtools-panel/index.tsx</code></td><td>核心面板组件，包含树、搜索、交互逻辑。</td></tr><tr><td><strong>LayoutPanel</strong></td><td><code>src/devtools/components/layout/index.tsx</code></td><td>提供可拖拽、停靠 (Dock) 的布局容器。</td></tr><tr><td><strong>Overlay</strong></td><td><code>src/devtools/components/overlay/index.ts</code></td><td>负责在 Canvas 上绘制高亮边框和提示信息。</td></tr><tr><td><strong>PropsEditor</strong></td><td><code>src/devtools/components/props-editor/index.tsx</code></td><td>显示并编辑当前选中 Widget 的属性。</td></tr></tbody></table><h2 id="_3-核心-api-接口" tabindex="-1">3. 核心 API 接口 <a class="header-anchor" href="#_3-核心-api-接口" aria-label="Permalink to &quot;3. 核心 API 接口&quot;">​</a></h2><h3 id="devtools-singleton-class" tabindex="-1"><code>Devtools</code> (Singleton Class) <a class="header-anchor" href="#devtools-singleton-class" aria-label="Permalink to &quot;`Devtools` (Singleton Class)&quot;">​</a></h3><p>管理 DevTools 面板的生命周期。</p><ul><li><code>getInstance(props?)</code>: 获取或创建单例。</li><li><code>show() / hide()</code>: 控制面板显示/隐藏。</li><li><code>dispose()</code>: 销毁实例，清理 DOM。</li><li><code>update(props?)</code>: 更新属性。</li></ul><h3 id="usemouseinteraction-hook" tabindex="-1"><code>useMouseInteraction</code> (Hook) <a class="header-anchor" href="#usemouseinteraction-hook" aria-label="Permalink to &quot;`useMouseInteraction` (Hook)&quot;">​</a></h3><p>处理鼠标在 Canvas 上的移动和点击事件。</p><ul><li><strong>输入</strong>: <code>runtime</code>, <code>overlay</code>, <code>active</code> (是否开启 inspect)。</li><li><strong>输出</strong>: <code>onPick</code> (选中回调), <code>runtimeId</code> (当前画布 ID)。</li><li><strong>功能</strong>: 利用 <code>hitTest</code> 识别鼠标下的 Widget，并调用 <code>overlay</code> 高亮。</li></ul><h2 id="_4-重要数据结构和状态管理" tabindex="-1">4. 重要数据结构和状态管理 <a class="header-anchor" href="#_4-重要数据结构和状态管理" aria-label="Permalink to &quot;4. 重要数据结构和状态管理&quot;">​</a></h2><h3 id="widget-tree-transformation" tabindex="-1">Widget Tree Transformation <a class="header-anchor" href="#widget-tree-transformation" aria-label="Permalink to &quot;Widget Tree Transformation&quot;">​</a></h3>',16)),o("ul",null,[e[2]||(e[2]=o("li",null,[o("strong",null,[o("code",null,"Widget"),t(" (Core)")]),t(": 运行时组件节点。")],-1)),o("li",null,[e[0]||(e[0]=o("strong",null,[o("code",null,"DevTreeNode"),t(" (DevTools)")],-1)),e[1]||(e[1]=t(": 轻量级树节点，用于 Antd Tree 展示。",-1)),a(r,{"code-base64":"dHlwZSBEZXZUcmVlTm9kZSA9IHsKICBrZXk6IHN0cmluZzsKICB0eXBlOiBzdHJpbmc7CiAgcHJvcHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjsKICBjaGlsZHJlbjogRGV2VHJlZU5vZGVbXTsKfTsK",lang:"ts",meta:""})])]),e[4]||(e[4]=d('<h3 id="state-management-mobx" tabindex="-1">State Management（MobX） <a class="header-anchor" href="#state-management-mobx" aria-label="Permalink to &quot;State Management（MobX）&quot;">​</a></h3><p>DevTools 采用 MobX 进行状态集中化管理，通过 RootStore 统一注入与响应式更新。</p><ul><li><code>DevtoolsRootStore</code>: 统一管理面板状态与布局状态，负责生命周期与调试接入。</li><li><code>DevtoolsPanelStore</code>: 组件树、拾取、Overlay、运行时与可见性等核心状态。</li><li><code>DevtoolsLayoutStore</code>: Dock 布局、分割尺寸与窄屏状态，统一持久化策略。 状态流转通过 <code>action</code> 统一修改，视图层通过 <code>observer</code> 获取响应式更新，避免跨组件的重复 <code>useState</code>。</li></ul><h2 id="_5-关键业务逻辑流程" tabindex="-1">5. 关键业务逻辑流程 <a class="header-anchor" href="#_5-关键业务逻辑流程" aria-label="Permalink to &quot;5. 关键业务逻辑流程&quot;">​</a></h2><h3 id="inspect-拾取-流程" tabindex="-1">Inspect (拾取) 流程 <a class="header-anchor" href="#inspect-拾取-流程" aria-label="Permalink to &quot;Inspect (拾取) 流程&quot;">​</a></h3><ol><li>用户点击 &quot;Inspect&quot; 按钮 (<code>activeInspect = true</code>)。</li><li><code>useMouseInteraction</code> 监听 <code>mousemove</code>。</li><li>调用 <code>Runtime</code> 的 <code>hitTest</code> 获取鼠标下的 Widget。</li><li>调用 <code>Overlay.highlight(widget)</code> 绘制高亮框。</li><li>用户点击 <code>click</code> -&gt; 触发 <code>onPick(widget)</code>。</li><li><code>DevToolsPanel</code> 更新 <code>selected</code>，计算路径并展开树节点 (<code>setExpandedKeys</code>)。</li><li><code>Tree</code> 组件滚动到对应节点。</li></ol><h3 id="tree-联动流程" tabindex="-1">Tree 联动流程 <a class="header-anchor" href="#tree-联动流程" aria-label="Permalink to &quot;Tree 联动流程&quot;">​</a></h3><ol><li><code>Runtime</code> 发生变化 (如 <code>rebuild</code>)。</li><li><code>DevToolsPanel</code> 重新计算 <code>treeData</code> (<code>toTree</code>)。</li><li><code>Tree</code> 组件刷新展示。</li><li>用户在 <code>Tree</code> 中 Hover/Select -&gt; 触发 <code>findWidget</code> 查找 Widget -&gt; 调用 <code>Overlay</code> 高亮。</li></ol><h2 id="_6-组件架构与嵌套关系" tabindex="-1">6. 组件架构与嵌套关系 <a class="header-anchor" href="#_6-组件架构与嵌套关系" aria-label="Permalink to &quot;6. 组件架构与嵌套关系&quot;">​</a></h2><h3 id="_6-1-层级结构" tabindex="-1">6.1 层级结构 <a class="header-anchor" href="#_6-1-层级结构" aria-label="Permalink to &quot;6.1 层级结构&quot;">​</a></h3><ul><li>DevTools（入口组件） <ul><li>DevToolsPanel <ul><li>DevToolsPanelInner <ul><li>Overlay（选中高亮）</li><li>LayoutPanel（布局容器） <ul><li>LayoutHeader <ul><li>DevtoolsHeaderLeft（拾取开关）</li><li>DevtoolsHeaderRight（帮助/关闭）</li></ul></li><li>LayoutContentGrid <ul><li>DevtoolsTreePane <ul><li>SimpleTip（多运行时提示）</li></ul></li><li>DevtoolsPropsPane <ul><li>PropsEditor <ul><li>Group / Section / ReadonlyRows</li><li>ObjectEditor <ul><li>DoubleClickEditableField</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><h3 id="_6-2-组件与数据流-mermaid" tabindex="-1">6.2 组件与数据流 Mermaid <a class="header-anchor" href="#_6-2-组件与数据流-mermaid" aria-label="Permalink to &quot;6.2 组件与数据流 Mermaid&quot;">​</a></h3>',12)),a(n,{"code-base64":"Zmxvd2NoYXJ0IFRECiAgUnVudGltZVtSdW50aW1lXSAtLT4gdXNlTW91c2VJbnRlcmFjdGlvblt1c2VNb3VzZUludGVyYWN0aW9uXQogIHVzZU1vdXNlSW50ZXJhY3Rpb24gLS0+IFBhbmVsU3RvcmVbRGV2dG9vbHNQYW5lbFN0b3JlXQogIFBhbmVsU3RvcmUgLS0+IERldnRvb2xzVHJlZVBhbmUKICBQYW5lbFN0b3JlIC0tPiBPdmVybGF5CgogIERldlRvb2xzIC0tPiBEZXZUb29sc1BhbmVsIC0tPiBEZXZUb29sc1BhbmVsSW5uZXIKICBEZXZUb29sc1BhbmVsSW5uZXIgLS0+IExheW91dFBhbmVsCiAgRGV2VG9vbHNQYW5lbElubmVyIC0tPiBPdmVybGF5CiAgTGF5b3V0UGFuZWwgLS0+IExheW91dEhlYWRlcgogIExheW91dEhlYWRlciAtLT4gRGV2dG9vbHNIZWFkZXJMZWZ0CiAgTGF5b3V0SGVhZGVyIC0tPiBEZXZ0b29sc0hlYWRlclJpZ2h0CiAgTGF5b3V0UGFuZWwgLS0+IExheW91dENvbnRlbnRHcmlkCiAgTGF5b3V0Q29udGVudEdyaWQgLS0+IERldnRvb2xzVHJlZVBhbmUKICBMYXlvdXRDb250ZW50R3JpZCAtLT4gRGV2dG9vbHNQcm9wc1BhbmUKICBEZXZ0b29sc1Byb3BzUGFuZSAtLT4gUHJvcHNFZGl0b3IKICBQcm9wc0VkaXRvciAtLT4gR3JvdXAKICBQcm9wc0VkaXRvciAtLT4gU2VjdGlvbgogIFByb3BzRWRpdG9yIC0tPiBSZWFkb25seVJvd3MKICBQcm9wc0VkaXRvciAtLT4gT2JqZWN0RWRpdG9yCiAgT2JqZWN0RWRpdG9yIC0tPiBEb3VibGVDbGlja0VkaXRhYmxlRmllbGQKICBEZXZ0b29sc1RyZWVQYW5lIC0tPiBTaW1wbGVUaXAK"}),e[5]||(e[5]=d('<h3 id="_6-3-组件清单与关键接口" tabindex="-1">6.3 组件清单与关键接口 <a class="header-anchor" href="#_6-3-组件清单与关键接口" aria-label="Permalink to &quot;6.3 组件清单与关键接口&quot;">​</a></h3><table tabindex="0"><thead><tr><th>组件</th><th>入口文件</th><th>作用</th><th>关键 props/events</th><th>测试文件</th></tr></thead><tbody><tr><td>DevTools</td><td><code>src/devtools/index.tsx</code></td><td>Devtools 入口与单例挂载</td><td><code>onClose</code>、<code>shortcut</code></td><td><code>src/devtools/__tests__/singleton.spec.tsx</code></td></tr><tr><td>DevToolsPanel</td><td><code>src/devtools/components/devtools-panel/index.tsx</code></td><td>创建 RootStore 并渲染面板</td><td><code>onClose</code>、<code>shortcut</code></td><td>无</td></tr><tr><td>DevToolsPanelInner</td><td><code>src/devtools/components/devtools-panel/panel-inner/index.tsx</code></td><td>组合布局与 Overlay</td><td><code>helpContent</code></td><td>无</td></tr><tr><td>LayoutPanel</td><td><code>src/devtools/components/layout/index.tsx</code></td><td>面板布局与拖拽</td><td><code>visible</code>、<code>treePaneProps</code>、<code>propsPaneProps</code>、<code>onVisibleChange</code></td><td>无</td></tr><tr><td>LayoutHeader</td><td><code>src/devtools/components/layout/header/index.tsx</code></td><td>Dock 切换与右侧扩展区</td><td><code>dock</code>、<code>onDockChange</code>、<code>onRequestClose</code></td><td>无</td></tr><tr><td>LayoutContentGrid</td><td><code>src/devtools/components/layout/content-grid/index.tsx</code></td><td>树/属性面板分割布局</td><td><code>info</code>、<code>treePaneProps</code>、<code>propsPaneProps</code>、<code>onSplitMouseDown</code></td><td>无</td></tr><tr><td>LayoutResizeHandle</td><td><code>src/devtools/components/layout/resize-handle/index.tsx</code></td><td>面板尺寸拖拽柄</td><td><code>cursor</code>、<code>onResizeMouseDown</code></td><td>无</td></tr><tr><td>DevtoolsHeaderLeft</td><td><code>src/devtools/components/devtools-panel/header-left/index.tsx</code></td><td>拾取开关按钮</td><td><code>activeInspect</code>、<code>onToggleInspect</code></td><td>无</td></tr><tr><td>DevtoolsHeaderRight</td><td><code>src/devtools/components/devtools-panel/header-right/index.tsx</code></td><td>帮助与关闭按钮</td><td><code>helpContent</code>、<code>onRequestClose</code></td><td>无</td></tr><tr><td>DevtoolsTreePane</td><td><code>src/devtools/components/devtools-panel/tree-pane/index.tsx</code></td><td>树视图与搜索</td><td><code>treeData</code>、<code>selectedKey</code>、<code>onSelectKey</code>、<code>onHoverKey</code></td><td>无</td></tr><tr><td>DevtoolsPropsPane</td><td><code>src/devtools/components/devtools-panel/props-pane/index.tsx</code></td><td>属性面板容器</td><td><code>widget</code>、<code>onApply</code></td><td>无</td></tr><tr><td>PropsEditor</td><td><code>src/devtools/components/props-editor/index.tsx</code></td><td>属性/状态编辑</td><td><code>widget</code>、<code>onChange</code></td><td>无</td></tr><tr><td>Group</td><td><code>src/devtools/components/props-editor/group/index.tsx</code></td><td>分组容器</td><td><code>title</code>、<code>children</code></td><td>无</td></tr><tr><td>Section</td><td><code>src/devtools/components/props-editor/section/index.tsx</code></td><td>分区容器</td><td><code>title</code>、<code>children</code></td><td>无</td></tr><tr><td>ReadonlyRows</td><td><code>src/devtools/components/props-editor/readonly-rows/index.tsx</code></td><td>只读行布局</td><td><code>items</code></td><td>无</td></tr><tr><td>ObjectEditor</td><td><code>src/devtools/components/object-editor/index.tsx</code></td><td>对象 KV 编辑</td><td><code>value</code>、<code>onChange</code>、<code>readOnly</code></td><td>无</td></tr><tr><td>DoubleClickEditableField</td><td><code>src/devtools/components/double-click-field/index.tsx</code></td><td>双击编辑字段</td><td><code>display</code>、<code>editor</code>、<code>editable</code></td><td>无</td></tr><tr><td>SimpleTip</td><td><code>src/devtools/components/simple-tip/index.tsx</code></td><td>提示图标与说明</td><td><code>message</code></td><td>无</td></tr><tr><td>Overlay</td><td><code>src/devtools/components/overlay/index.tsx</code></td><td>Canvas 高亮覆盖层</td><td><code>runtime</code>、<code>active</code>、<code>widget</code></td><td><code>src/devtools/__tests__/overlay-highlight-dedupe.spec.tsx</code></td></tr></tbody></table>',2))])}c(b,"_sfc_render");const R=u(p,[["render",b]]);export{_ as __pageData,R as default};
